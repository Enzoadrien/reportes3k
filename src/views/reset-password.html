<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Restablecer Contrase√±a</title>
<link rel="stylesheet" href="/css/globals.css">
<script src="/js/reset.js" defer></script>

</head>
<body>
<main>
    <form id="resetForm">
    <h2>Restablecer Contrase√±a</h2>
    <p>Ingresa tu nueva contrase√±a.</p>

    <label for="password">Nueva contrase√±a</label>
    <input type="password" id="password" required>

    <label for="confirm">Confirmar contrase√±a</label>
    <input type="password" id="confirm" required>

    <button type="submit">Cambiar contrase√±a</button>
    <p id="msg"></p>
    </form>
</main>

<script defer>
    const form = document.getElementById("resetForm");
    const msg = document.getElementById("msg");

    form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const password = document.getElementById("password").value;
    const confirm = document.getElementById("confirm").value;

    if (password !== confirm) {
        msg.style.color = "red";
        msg.textContent = "‚ö†Ô∏è Las contrase√±as no coinciden.";
        return;
    }

    msg.textContent = "Procesando...";

    try {
        const res = await fetch("/api/password/reset", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include", // üîπ importante para enviar cookie HTTP-only
        body: JSON.stringify({ nuevaContrasena: password })
        });

        const data = await res.json();
        msg.style.color = data.ok ? "green" : "red";
        msg.textContent = data.message;
        if (data.ok) form.reset();
    } catch {
        msg.style.color = "red";
        msg.textContent = "‚ùå Error del servidor.";
    }
    });
</script>
</body>
</html>
